{
  "title": "Static Web App - Application Insights Dashboard (Logs_update)",
  "uid": "swa-appinsights-logs-v2",
  "schemaVersion": 39,
  "editable": false,
  "refresh": "30s",
  "time": { "from": "now-24h", "to": "now" },
  "templating": {
    "list": [
      {
        "name": "azure_monitor_ds",
        "type": "datasource",
        "query": "grafana-azure-monitor-datasource",
        "refresh": 1
      },
      {
        "name": "resource_group",
        "type": "query",
        "datasource": { "type": "grafana-azure-monitor-datasource", "uid": "$azure_monitor_ds" },
        "query": "ResourceGroups()",
        "refresh": 1
      },
      {
        "name": "log_analytics_ws",
        "type": "query",
        "datasource": { "type": "grafana-azure-monitor-datasource", "uid": "$azure_monitor_ds" },
        "query": "ResourceNames($resource_group, Microsoft.OperationalInsights/workspaces)",
        "refresh": 1
      }
    ]
  },
  "panels": [
    {
      "id": 1,
      "title": "Page Views",
      "type": "timeseries",
      "gridPos": { "h": 9, "w": 8, "x": 0, "y": 0 },
      "datasource": { "type": "grafana-azure-monitor-datasource", "uid": "$azure_monitor_ds" },
      "targets": [
        {
          "refId": "A",
          "queryType": "Logs",
          "resultFormat": "time_series",
          "timeColumn": "TimeGenerated",
          "resource": "$log_analytics_ws",
          "query": "AppPageViews | where $__timeFilter(TimeGenerated) | summarize total = count() by bin(TimeGenerated, 5m) | order by TimeGenerated asc"
        }
      ]
    },
    {
      "id": 2,
      "title": "Unique Users",
      "type": "timeseries",
      "gridPos": { "h": 9, "w": 8, "x": 8, "y": 0 },
      "datasource": { "type": "grafana-azure-monitor-datasource", "uid": "$azure_monitor_ds" },
      "targets": [
        {
          "refId": "A",
          "queryType": "Logs",
          "resultFormat": "time_series",
          "timeColumn": "TimeGenerated",
          "resource": "$log_analytics_ws",
          "query": "AppPageViews | where $__timeFilter(TimeGenerated) | extend u = coalesce(user_Id, UserId) | summarize users = dcount(u) by bin(TimeGenerated, 5m) | order by TimeGenerated asc"
        }
      ]
    },
    {
      "id": 3,
      "title": "User Sessions",
      "type": "timeseries",
      "gridPos": { "h": 9, "w": 8, "x": 16, "y": 0 },
      "datasource": { "type": "grafana-azure-monitor-datasource", "uid": "$azure_monitor_ds" },
      "targets": [
        {
          "refId": "A",
          "queryType": "Logs",
          "resultFormat": "time_series",
          "timeColumn": "TimeGenerated",
          "resource": "$log_analytics_ws",
          "query": "AppPageViews | where $__timeFilter(TimeGenerated) | extend s = coalesce(session_Id, SessionId) | summarize sessions = dcount(s) by bin(TimeGenerated, 5m) | order by TimeGenerated asc"
        }
      ]
    },
    {
      "id": 4,
      "title": "Page Load Performance (avg ms)",
      "type": "timeseries",
      "gridPos": { "h": 9, "w": 8, "x": 0, "y": 9 },
      "datasource": { "type": "grafana-azure-monitor-datasource", "uid": "$azure_monitor_ds" },
      "targets": [
        {
          "refId": "A",
          "queryType": "Logs",
          "resultFormat": "time_series",
          "timeColumn": "TimeGenerated",
          "resource": "$log_analytics_ws",
          "query": "AppBrowserTimings | where $__timeFilter(TimeGenerated) | summarize avg_ms = avg(todouble(Duration)) by bin(TimeGenerated, 5m) | order by TimeGenerated asc"
        }
      ]
    },
    {
      "id": 5,
      "title": "Errors & Failed Requests",
      "type": "timeseries",
      "gridPos": { "h": 9, "w": 8, "x": 8, "y": 9 },
      "datasource": { "type": "grafana-azure-monitor-datasource", "uid": "$azure_monitor_ds" },
      "targets": [
        {
          "refId": "A",
          "queryType": "Logs",
          "resultFormat": "time_series",
          "timeColumn": "TimeGenerated",
          "resource": "$log_analytics_ws",
          "query": "AppRequests | where $__timeFilter(TimeGenerated) | summarize failed = countif(tolong(ResultCode) >= 400 or Success == false), total = count() by bin(TimeGenerated, 5m) | extend errorRate = 100.0 * todouble(failed) / todouble(total) | project TimeGenerated, errorRate | order by TimeGenerated asc"
        }
      ]
    },
    {
      "id": 6,
      "title": "Active Users (1h)",
      "type": "stat",
      "gridPos": { "h": 9, "w": 8, "x": 16, "y": 9 },
      "datasource": { "type": "grafana-azure-monitor-datasource", "uid": "$azure_monitor_ds" },
      "targets": [
        {
          "refId": "A",
          "queryType": "Logs",
          "resultFormat": "table",
          "timeColumn": "TimeGenerated",
          "resource": "$log_analytics_ws",
          "query": "AppPageViews | where TimeGenerated > ago(1h) | extend u = coalesce(user_Id, UserId) | summarize active_users = dcount(u)"
        }
      ]
    },
    {
      "id": 7,
      "title": "Total Page Views (1h)",
      "type": "stat",
      "gridPos": { "h": 9, "w": 8, "x": 0, "y": 18 },
      "datasource": { "type": "grafana-azure-monitor-datasource", "uid": "$azure_monitor_ds" },
      "targets": [
        {
          "refId": "A",
          "queryType": "Logs",
          "resultFormat": "table",
          "timeColumn": "TimeGenerated",
          "resource": "$log_analytics_ws",
          "query": "AppPageViews | where TimeGenerated > ago(1h) | summarize total = count()"
        }
      ]
    },
    {
      "id": 8,
      "title": "Exceptions (1h)",
      "type": "stat",
      "gridPos": { "h": 9, "w": 8, "x": 8, "y": 18 },
      "datasource": { "type": "grafana-azure-monitor-datasource", "uid": "$azure_monitor_ds" },
      "targets": [
        {
          "refId": "A",
          "queryType": "Logs",
          "resultFormat": "table",
          "timeColumn": "TimeGenerated",
          "resource": "$log_analytics_ws",
          "query": "AppExceptions | where TimeGenerated > ago(1h) | summarize total = count()"
        }
      ]
    },
    {
      "id": 9,
      "title": "Browser Usage (Top 10)",
      "type": "table",
      "gridPos": { "h": 9, "w": 8, "x": 16, "y": 18 },
      "datasource": { "type": "grafana-azure-monitor-datasource", "uid": "$azure_monitor_ds" },
      "targets": [
        {
          "refId": "A",
          "queryType": "Logs",
          "resultFormat": "table",
          "timeColumn": "TimeGenerated",
          "resource": "$log_analytics_ws",
          "query": "AppPageViews | where $__timeFilter(TimeGenerated) | summarize total = count() by tostring(coalesce(client_Browser, Browser)) | top 10 by total desc"
        }
      ]
    },
    {
      "id": 10,
      "title": "Users by Country (Top 10)",
      "type": "table",
      "gridPos": { "h": 9, "w": 12, "x": 0, "y": 27 },
      "datasource": { "type": "grafana-azure-monitor-datasource", "uid": "$azure_monitor_ds" },
      "targets": [
        {
          "refId": "A",
          "queryType": "Logs",
          "resultFormat": "table",
          "timeColumn": "TimeGenerated",
          "resource": "$log_analytics_ws",
          "query": "AppPageViews | where $__timeFilter(TimeGenerated) | summarize users = dcount(coalesce(user_Id, UserId)) by tostring(coalesce(client_CountryOrRegion, Country)) | top 10 by users desc"
        }
      ]
    },
    {
      "id": 11,
      "title": "Requests by ResultCode",
      "type": "table",
      "gridPos": { "h": 9, "w": 12, "x": 12, "y": 27 },
      "datasource": { "type": "grafana-azure-monitor-datasource", "uid": "$azure_monitor_ds" },
      "targets": [
        {
          "refId": "A",
          "queryType": "Logs",
          "resultFormat": "table",
          "timeColumn": "TimeGenerated",
          "resource": "$log_analytics_ws",
          "query": "AppRequests | where $__timeFilter(TimeGenerated) | summarize total = count() by tostring(ResultCode) | top 10 by total desc"
        }
      ]
    }
  ],
  "version": 1
}
