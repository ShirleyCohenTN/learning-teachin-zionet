{
  "id": null,
  "uid": "static-webapp-ai-logs",
  "title": "Static Web App - Application Insights Dashboard (Logs)",
  "timezone": "browser",
  "schemaVersion": 38,
  "version": 1,
  "editable": true,
  "graphTooltip": 0,
  "style": "dark",
  "tags": ["static-web-app", "application-insights", "log-analytics"],
  "time": { "from": "now-24h", "to": "now" },
  "timepicker": { "refresh_intervals": ["10s","30s","1m","5m","15m","30m","1h"] },

  "templating": {
    "list": [
      {
        "name": "azure_monitor_ds",
        "type": "datasource",
        "query": "grafana-azure-monitor-datasource",
        "current": {},
        "hide": 0,
        "label": "Azure Monitor datasource"
      },
      {
        "name": "resource_group",
        "type": "query",
        "label": "Resource Group",
        "datasource": { "type": "grafana-azure-monitor-datasource", "uid": "${azure_monitor_ds}" },
        "definition": "ResourceGroups()",
        "query": "ResourceGroups()",
        "refresh": 1,
        "hide": 0,
        "includeAll": false
      },
      {
        "name": "log_analytics_workspace",
        "type": "query",
        "label": "Log Analytics Workspace",
        "datasource": { "type": "grafana-azure-monitor-datasource", "uid": "${azure_monitor_ds}" },
        "definition": "ResourceNames($resource_group, Microsoft.OperationalInsights/workspaces)",
        "query": "ResourceNames($resource_group, Microsoft.OperationalInsights/workspaces)",
        "refresh": 1,
        "hide": 0,
        "includeAll": false
      }
    ]
  },

  "panels": [
    {
      "type": "timeseries",
      "title": "Page Views",
      "gridPos": { "h": 8, "w": 12, "x": 0, "y": 0 },
      "datasource": { "type": "grafana-azure-monitor-datasource", "uid": "${azure_monitor_ds}" },
      "fieldConfig": { "defaults": { "unit": "short" }, "overrides": [] },
      "targets": [
        {
          "refId": "A",
          "format": "time_series",
          "service": "logAnalytics",
          "resource": "$log_analytics_workspace",
          "timeColumn": "TimeGenerated",
          "query": "AppPageViews\n| where $__timeFilter(TimeGenerated)\n| summarize total = count() by bin(TimeGenerated, 5m)\n| order by TimeGenerated asc"
        }
      ]
    },

    {
      "type": "timeseries",
      "title": "Unique Users",
      "gridPos": { "h": 8, "w": 12, "x": 12, "y": 0 },
      "datasource": { "type": "grafana-azure-monitor-datasource", "uid": "${azure_monitor_ds}" },
      "targets": [
        {
          "refId": "A",
          "format": "time_series",
          "service": "logAnalytics",
          "resource": "$log_analytics_workspace",
          "timeColumn": "TimeGenerated",
          "query": "AppPageViews\n| where $__timeFilter(TimeGenerated)\n| summarize unique_users = dcount(user_Id) by bin(TimeGenerated, 1h)\n| order by TimeGenerated asc"
        }
      ]
    },

    {
      "type": "timeseries",
      "title": "User Sessions",
      "gridPos": { "h": 8, "w": 12, "x": 0, "y": 8 },
      "datasource": { "type": "grafana-azure-monitor-datasource", "uid": "${azure_monitor_ds}" },
      "targets": [
        {
          "refId": "A",
          "format": "time_series",
          "service": "logAnalytics",
          "resource": "$log_analytics_workspace",
          "timeColumn": "TimeGenerated",
          "query": "AppPageViews\n| where $__timeFilter(TimeGenerated)\n| summarize sessions = dcount(session_Id) by bin(TimeGenerated, 1h)\n| order by TimeGenerated asc"
        }
      ]
    },

    {
      "type": "timeseries",
      "title": "Errors & Failed Requests (rate %)",
      "gridPos": { "h": 8, "w": 12, "x": 12, "y": 8 },
      "datasource": { "type": "grafana-azure-monitor-datasource", "uid": "${azure_monitor_ds}" },
      "fieldConfig": { "defaults": { "unit": "percent" }, "overrides": [] },
      "targets": [
        {
          "refId": "A",
          "format": "time_series",
          "service": "logAnalytics",
          "resource": "$log_analytics_workspace",
          "timeColumn": "TimeGenerated",
          "query": "AppRequests\n| where $__timeFilter(TimeGenerated)\n| summarize failed = countif(success == false), total = count() by bin(TimeGenerated, 5m)\n| extend errorRate = 100.0 * todouble(failed) / todouble(total)\n| project TimeGenerated, errorRate\n| order by TimeGenerated asc"
        }
      ]
    },

    {
      "type": "timeseries",
      "title": "Page Load Performance (avg ms)",
      "gridPos": { "h": 8, "w": 12, "x": 0, "y": 16 },
      "datasource": { "type": "grafana-azure-monitor-datasource", "uid": "${azure_monitor_ds}" },
      "fieldConfig": { "defaults": { "unit": "ms" }, "overrides": [] },
      "targets": [
        {
          "refId": "A",
          "format": "time_series",
          "service": "logAnalytics",
          "resource": "$log_analytics_workspace",
          "timeColumn": "TimeGenerated",
          "query": "AppBrowserTimings\n| where $__timeFilter(TimeGenerated)\n| summarize avgLoadMs = avg(todouble(duration)) by bin(TimeGenerated, 5m)\n| project TimeGenerated, avgLoadMs\n| order by TimeGenerated asc"
        }
      ]
    },

    {
      "type": "stat",
      "title": "Active Users (last 1h)",
      "gridPos": { "h": 8, "w": 6, "x": 12, "y": 16 },
      "datasource": { "type": "grafana-azure-monitor-datasource", "uid": "${azure_monitor_ds}" },
      "targets": [
        {
          "refId": "A",
          "format": "table",
          "service": "logAnalytics",
          "resource": "$log_analytics_workspace",
          "timeColumn": "TimeGenerated",
          "query": "AppPageViews\n| where TimeGenerated >= ago(1h)\n| summarize active = dcount(user_Id)\n| project active"
        }
      ],
      "options": { "reduceOptions": { "values": false, "calcs": ["lastNotNull"] }, "orientation": "horizontal" }
    },

    {
      "type": "stat",
      "title": "Total Page Views (last 1h)",
      "gridPos": { "h": 8, "w": 6, "x": 18, "y": 16 },
      "datasource": { "type": "grafana-azure-monitor-datasource", "uid": "${azure_monitor_ds}" },
      "targets": [
        {
          "refId": "A",
          "format": "table",
          "service": "logAnalytics",
          "resource": "$log_analytics_workspace",
          "timeColumn": "TimeGenerated",
          "query": "AppPageViews\n| where TimeGenerated >= ago(1h)\n| summarize total = count()\n| project total"
        }
      ],
      "options": { "reduceOptions": { "values": false, "calcs": ["lastNotNull"] }, "orientation": "horizontal" }
    },

    {
      "type": "timeseries",
      "title": "Exceptions (1h bins)",
      "gridPos": { "h": 8, "w": 12, "x": 0, "y": 24 },
      "datasource": { "type": "grafana-azure-monitor-datasource", "uid": "${azure_monitor_ds}" },
      "targets": [
        {
          "refId": "A",
          "format": "time_series",
          "service": "logAnalytics",
          "resource": "$log_analytics_workspace",
          "timeColumn": "TimeGenerated",
          "query": "AppExceptions\n| where $__timeFilter(TimeGenerated)\n| summarize total = count() by bin(TimeGenerated, 1h)\n| order by TimeGenerated asc"
        }
      ]
    },

    {
      "type": "bargauge",
      "title": "Browser Usage (top 10)",
      "gridPos": { "h": 8, "w": 12, "x": 12, "y": 24 },
      "datasource": { "type": "grafana-azure-monitor-datasource", "uid": "${azure_monitor_ds}" },
      "targets": [
        {
          "refId": "A",
          "format": "table",
          "service": "logAnalytics",
          "resource": "$log_analytics_workspace",
          "timeColumn": "TimeGenerated",
          "query": "AppPageViews\n| where $__timeFilter(TimeGenerated)\n| summarize total = count() by client_Browser\n| top 10 by total desc\n| project client_Browser, total"
        }
      ],
      "options": { "displayMode": "gradient", "orientation": "horizontal", "reduceOptions": { "calcs": ["lastNotNull"], "values": true } },
      "fieldConfig": { "defaults": { "unit": "short" }, "overrides": [] }
    },

    {
      "type": "bargauge",
      "title": "Users by Country (top 10)",
      "gridPos": { "h": 8, "w": 12, "x": 0, "y": 32 },
      "datasource": { "type": "grafana-azure-monitor-datasource", "uid": "${azure_monitor_ds}" },
      "targets": [
        {
          "refId": "A",
          "format": "table",
          "service": "logAnalytics",
          "resource": "$log_analytics_workspace",
          "timeColumn": "TimeGenerated",
          "query": "AppPageViews\n| where $__timeFilter(TimeGenerated)\n| summarize users = dcount(user_Id) by client_CountryOrRegion\n| top 10 by users desc\n| project client_CountryOrRegion, users"
        }
      ],
      "options": { "displayMode": "basic", "orientation": "horizontal", "reduceOptions": { "calcs": ["lastNotNull"], "values": true } }
    }
  ]
}